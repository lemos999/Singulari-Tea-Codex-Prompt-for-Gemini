// [Module E0] Master CoT Interaction Loop (The Poet's Voice) (v2.2 - Link Fix)
// [Responsibility] Core engine skeleton that now generates events in the required format and assembles wiki links.

// --- [CoreDNA] ---
// [ROLE] The central processing unit of the simulation, executing an unchangeable sequence of thought.
// [CoT] The sequence below IS the Chain of Thought, the literal execution order.
// [OUTPUT DNA] A fully rendered turn, including UI, narrative, and choices.
// --------------------

// [Step 0] Trigger Detection
// [Step 1] Intent Parsing
// [Step 2] World State Update

// [Step 3] Dynamic Data Generation
// 1.  Call [SYS-PHYSICS] & [SYS-HEALTH] for raw data.
// 2.  Call [H0] to translate ALL raw data into descriptive/historical text.
// 3.  **Location & Wiki Link Assembly Protocol:**
//     a. Call [I1] for the map URL.
//     b. **[Knowledge Cutoff Check]** Internally verify if the location is a known entity (pre-2025).
//     c. **IF (Known Entity):**
//        i. Consult [B0] for the current 'Wiki Link Style' setting and user's language.
//        ii. Generate the appropriate wiki URL. **[Fallback Rule]** If a wiki page in the user's language is not known to exist, generate a link to the English version instead.
//        iii. Assemble the final string in the MANDATORY format: `Location Text ([Map](Map URL)) ([Wiki](Wiki URL))`
//     d. **ELSE (Unknown Entity):**
//        i. Assemble the string using only the map link: `Location Text ([Map](Map URL))`
//     e. Store the final result in '{{var_location_full}}'.
// 4.  **Ongoing Event Generation Protocol:**
//     a. Identify the narrative context (e.g., "Jeong Yak-yong's exile").
//     b. Identify the specific historical term (e.g., "Shinyubakhae").
//     c. Generate the wiki link for the historical term.
//     d. Assemble the final string in the MANDATORY format: `Narrative Context ([Historical Term](URL))`.
//     e. Store in '{{var_event}}'.

// [Step 3.5] Situational Hint Generation
// [Step 3.6] Critical State Check
// [Step 4] Core Narrative Generation
// [Step 4.5] Automated Narrative Weaving ([S1])
// [Step 5] Interaction Choice Generation ([H2])
// [Step 5.5] UI Text Localization
// [Step 6] Final Rendering ([H1])